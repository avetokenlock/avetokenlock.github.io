import{g as q,T,f as F,a as G,b as A,B as H}from"./TokenIcon-c47f51c7.js";import{_ as J,d as X,f as lo,g as I,o as k,A as E,w as u,j as e,t as n,k as o,h as b,c,l as v,D as Z,E as co,b as io,r as h,B as ro,H as uo,F as R,x as m,z as ko,L as z,O as K,N as Q,V as vo,I as C,P as po}from"./index-e37ff026.js";/* empty css                                                              */import{I as ho}from"./InputQty-706dce3e.js";import{O as mo,S as fo}from"./InputQty.vuevuetypestyleindex0scoped3bea6b36lang-438133be.js";const _o={class:"ave-popup"},yo={class:"title"},wo={class:"body"},go={class:"info"},Co={class:"key"},bo={class:"value"},$o={key:0,class:"token"},Io={key:1,class:"token"},To={key:2,class:"token"},Ao={class:"key"},Lo={class:"value"},Do={class:"key"},So={class:"value"},Bo={class:"key"},Po={class:"value"},No={class:"blue-font"},Eo={class:"key"},Fo={class:"value"},Go={class:"tips"},Uo={__name:"LockConfirmPopup",props:{show:Boolean,showGas:String,amount:String,unlockDate:Date},emits:["update:show","confirm"],setup(_,{emit:r}){const S=_,s=X(),L=lo(()=>{if(!S.unlockDate)return 0;const i=A(S.unlockDate),t=A().startOf("day");return i.diff(t,"day")});function D(){r("confirm")}return(i,t)=>{const U=I("van-button"),y=I("van-popup");return k(),E(y,{show:_.show,"onUpdate:show":t[0]||(t[0]=p=>{r("update:show",p)}),round:"",closeable:"",position:"bottom"},{default:u(()=>[e("div",_o,[e("div",yo,n(i.$t("lockConfirm")),1),e("div",wo,[e("ul",go,[e("li",null,[e("div",Co,n(i.$t("lockAssets")),1),e("div",bo,[o(s).token?o(s).token.tokenType==0?(k(),b("div",Io,[c(T,{class:"token-icon",tokenIcon:o(s).token.icon,chainIcon:o(q)(o(s).token.chain)},null,8,["tokenIcon","chainIcon"]),v(" "+n(`${o(s).token.symbol} (${o(F)(o(s).token.address)})`),1)])):o(s).token.tokenType==1?(k(),b("div",To,[c(T,{class:"token-icon",tokenIcon:o(G)(o(s).token.chain,o(s).token.tokenList[0].address)},null,8,["tokenIcon"]),c(T,{class:"token-icon",tokenIcon:o(G)(o(s).token.chain,o(s).token.tokenList[1].address)},null,8,["tokenIcon"]),v(" "+n(`${o(s).token.symbol} (${o(F)(o(s).token.address)})`),1)])):Z("",!0):(k(),b("div",$o," -- "))])]),e("li",null,[e("div",Ao,n(i.$t("lockNumber")),1),e("div",Lo,n(_.amount),1)]),e("li",null,[e("div",Do,n(i.$t("contractChian")),1),e("div",So,n(o(s).token?o(s).token.chain.toUpperCase():"--"),1)]),e("li",null,[e("div",Bo,n(i.$t("unlockTime2")),1),e("div",Po,[e("span",null,n(o(A)(_.unlockDate).format("YYYY-MM-DD")),1),e("span",null,[v("("),e("span",No,n(i.$t("dayLeft",{day:o(L)})),1),v(")")])])]),e("li",null,[e("div",Eo,n(i.$t("serviceFee")),1),e("div",Fo,n(o(s).token&&_.showGas?`${_.showGas} ${o(s).token.chainCoinSymbol.toUpperCase()}`:"--"),1)])]),e("div",Go,[e("div",null,n(i.$t("createTips1")),1),e("div",null,n(i.$t("createTips2")),1),e("div",null,n(i.$t("createTips3")),1)]),c(U,{class:"btn",type:"primary",block:"",onClick:D},{default:u(()=>[v(n(i.$t("confirmAndLock")),1)]),_:1})])])]),_:1},8,["show"])}}},Oo=J(Uo,[["__scopeId","data-v-876b4810"]]);const Mo={class:"body"},Vo={class:"title token-title"},Wo={key:0,class:"token-box"},Ho={key:1,class:"token"},Yo={class:"title"},jo={class:"title"},xo={__name:"Create",setup(_){const{t:r}=co(),S=io("global"),s=h(!1),L=h(!1),D=h(!1),i=ro(),t=X(),U=A().startOf("day").add(1,"day").toDate(),y=h(U),p=h(""),B=h(!1),Y=h(""),O=h(!1),M=h("");async function oo(){await t.connectWallet()}async function j(){console.log("checkAllowance"),await m.wallet.isAllowanceEnough(t.lockContractAddress,t.token.address,t.walletAddress)?s.value=!1:s.value=!0}async function to(){L.value=!0;try{let a=await m.wallet.approveMaxAmount(t.token.address,t.lockContractAddress);console.log(a),await a.wait(),s.value=!1}catch(a){console.log(a)}finally{L.value=!1}}async function eo(){D.value=!0,M.value="";try{if(!t.token){C(r("pleaseSelectToken"));return}if(!p.value){C(r("enterAmount"));return}let a=S.cfg.allowChainList.find(w=>w.chain==t.token.chain);if(!a){C(r("tokenChainNotSupport"));return}if(t.chainId!=a.chainId){C(r("switchTokenChain"));try{await m.wallet.switchNetwork(a.chainId)}catch{C(r("switchTokenChain"));return}return}if(Number(p)>t.token.amount){C(r("blanceSlow"));return}if(await j(),s.value){C(r("approveFirst"));return}await no()}catch(a){console.log(a)}finally{D.value=!1}}async function no(){const a=t.token.address,l=m.wallet.getEthersProvider(),f=await m.wallet.contractByProvider(l,a,z).decimals(),g=t.walletAddress,P=t.token.tokenType==1,d=K(p.value,f),V=A(y.value).unix(),W="",N=m.wallet.contractByProvider(l,t.lockContractAddress,Q);console.dir(N);const $=await l.getGasPrice();let x=await N.estimateGas.lock(g,a,P,d.toString(),V,W);console.dir(x),Y.value=po(x.mul($)).toString(),B.value=!0}async function so(){const a=ko({message:"Loading...",forbidClick:!0,duration:0}),l=t.token.address,w=t.walletAddress,f=m.wallet.getEthersProvider(),g=t.token.tokenType==1,d=await m.wallet.contractByProvider(f,l,z).decimals(),V=K(p.value,d),W=A(y.value).unix(),N=m.wallet.contractByProvider(f,t.lockContractAddress,Q);try{let $=await N.lock(w,l,g,V.toString(),W,"");console.dir($),M.value=$.hash,O.value=!0,B.value=!1}catch($){console.log($)}finally{a.close()}}function ao(){i.push("/selectToken")}return uo(()=>{console.log("onMounted"),t.chainId>0&&t.isConnectWallet&&t.token&&j()}),(a,l)=>{const w=I("van-cell"),f=I("van-cell-group"),g=I("van-button"),P=I("van-action-bar");return k(),b(R,null,[e("div",Mo,[c(f,{inset:"",class:"form-item"},{default:u(()=>[e("div",Vo,n(a.$t("selectToken2")),1),c(w,{"is-link":"",class:"token-cell",onClick:ao},vo({_:2},[o(t).token?{name:"title",fn:u(()=>[o(t).token.tokenType==0?(k(),b("div",Wo,[c(T,{class:"token-icon",tokenIcon:o(t).token.icon,chainIcon:o(q)(o(t).token.chain)},null,8,["tokenIcon","chainIcon"]),v(" "+n(`${o(t).token.symbol} (${o(F)(o(t).token.address)})`),1)])):o(t).token.tokenType==1?(k(),b("div",Ho,[c(T,{class:"token-icon",tokenIcon:o(G)(o(t).token.chain,o(t).token.tokenList[0].address)},null,8,["tokenIcon"]),c(T,{class:"token-icon",tokenIcon:o(G)(o(t).token.chain,o(t).token.tokenList[1].address)},null,8,["tokenIcon"]),v(" "+n(`${o(t).token.symbol} (${o(F)(o(t).token.address)})`),1)])):Z("",!0)]),key:"0"}:{name:"title",fn:u(()=>[e("div",{class:"token-box",style:{color:"#999999"}},n(a.$t("pleaseSelectToken")),1)]),key:"1"}]),1024)]),_:1}),c(f,{inset:"",class:"form-item"},{default:u(()=>[e("div",Yo,[e("div",null,n(o(r)("setNumberOfLock")),1),e("div",null,[v(n(`${o(r)("balance")}: `),1),e("span",null,n(o(t).token?o(H)(o(t).token.amount).toString().indexOf(".")==-1?o(H)(o(t).token.amount):o(H)(o(t).token.amount).toFixed(6):"--"),1)])]),e("div",null,[c(ho,{amount:p.value,"onUpdate:amount":l[0]||(l[0]=d=>p.value=d),total:o(t).token?o(t).token.amount:0},null,8,["amount","total"])])]),_:1}),c(f,{inset:"",class:"form-item"},{default:u(()=>[e("div",jo,[e("div",null,n(a.$t("setDate")),1)]),e("div",null,[c(fo,{date:y.value,"onUpdate:date":l[1]||(l[1]=d=>y.value=d),showTools:""},null,8,["date"])])]),_:1})]),c(P,{class:"tools"},{default:u(()=>[o(t).isConnectWallet?(k(),b(R,{key:0},[s.value?(k(),E(g,{key:0,class:"btn",type:"danger",onClick:to,block:"",loading:L.value},{default:u(()=>[v(n(a.$t("approve")),1)]),_:1},8,["loading"])):(k(),E(g,{key:1,class:"btn",color:"#3F80F7",onClick:eo,block:"",loading:D.value},{default:u(()=>[v(n(a.$t("oneKeyLock")),1)]),_:1},8,["loading"]))],64)):(k(),E(g,{key:1,class:"btn",type:"primary",onClick:oo,block:""},{default:u(()=>[v(n(a.$t("connectWallet")),1)]),_:1}))]),_:1}),c(Oo,{show:B.value,"onUpdate:show":l[2]||(l[2]=d=>B.value=d),unlockDate:y.value,amount:p.value,showGas:Y.value,onConfirm:so},null,8,["show","unlockDate","amount","showGas"]),c(mo,{show:O.value,"onUpdate:show":l[3]||(l[3]=d=>O.value=d),txHash:M.value},null,8,["show","txHash"])],64)}}},Jo=J(xo,[["__scopeId","data-v-d678f755"]]);export{Jo as default};
