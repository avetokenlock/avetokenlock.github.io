import{T as I}from"./TokenIcon-11e8e5f5.js";import{_ as G,b as H,y as J,W as P,d as K,C as Q,r as f,D as X,G as Y,f as L,o as i,g as _,c as m,j as s,I as T,F as b,z as V,x as n,h as x,H as Z,n as p,J as D,t as v,v as O,B as ee,l as oe}from"./index-5a0fd75d.js";import{a as te,f as R,b as S,B as g}from"./bignumber-ea2dde45.js";import{l as se}from"./lpABI-5e9b72a1.js";const ne={class:"body"},ae={class:"content"},le={class:"type"},ce={class:"network"},ie={class:"network-list"},re=["onClick"],de={class:"item-left"},ue={class:"left-content"},ke={class:"token-name"},ve={class:"token-address"},_e={class:"token"},he={class:"left-content"},fe={class:"token-name"},me={class:"token-address"},pe={class:"item-right"},Ce={class:"item-right-left"},we={class:"qty"},ye={class:"amount"},Le={class:"item-right-right"},be={__name:"SelectToken",setup(ge){const E=H("global"),$=J();P();const r=K();Q();const C=f([]),d=f([]),l=f(""),u=f(0),M=X(()=>u.value==0?l.value?l.value.startsWith("0x")?C.value.filter(o=>o.address.toLowerCase()==l.value.toLowerCase()):C.value.filter(o=>o.symbol.toLowerCase().indexOf(l.value.toLowerCase())>-1):C.value:u.value==1?l.value?l.value.startsWith("0x")?d.value.filter(o=>o.address.toLowerCase()==l.value.toLowerCase()):d.value.filter(o=>o.symbol.toLowerCase().indexOf(l.value.toLowerCase())>-1):d.value:[]),B=E.cfg.allowChainList,c=f(B[0]);async function U(o){c.value.chain!=o.chain&&(c.value=o,A())}async function A(){const o=oe({message:"Loading...",forbidClick:!0,duration:0}),a=await p.debank.getTokenList(r.walletAddress,c.value.chain);let k=[],h=[];for(let e of a.data.data)e.token=="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"&&(e.token=p.wallet.MAIN_COIN_ADDRESS),new RegExp("^0x.*$","gi").test(e.token)&&e.value>0&&e.risk_score<60&&e.risk_level>=0&&e.flag!=="blacklist"&&e.symbol!==""&&(e.flag=="lp"?h.push({tokenList:[{address:"",symbol:""},{address:"",symbol:""}],symbol:"",address:e.token.toLowerCase(),tokenId:`${e.token}-${e.chain}`.toLowerCase(),chain:e.chain.toLowerCase(),decimals:e.decimals,amount:e.value,price:e.current_price_usd,hasTokenInfo:!1,tokenType:1,chainCoinSymbol:c.value.chainCoinSymbol,name:e.name}):k.push({address:e.token.toLowerCase(),tokenId:`${e.token}-${e.chain}`.toLowerCase(),chain:e.chain.toLowerCase(),symbol:e.symbol,decimals:e.decimals,icon:S(e.chain.toLowerCase(),e.token.toLowerCase()),amount:e.value,price:e.current_price_usd,tokenType:0,chainCoinSymbol:c.value.chainCoinSymbol,name:e.name}));C.value=k,d.value=h,o.close()}const N="/create";function W(o){r.isSelectSearchToken=!1,r.token=o,$.push(N)}function j(){$.push(N)}async function z(){console.log("init"),r.isConnectWallet&&await A()}function F(o){u.value!=o&&(u.value=o,o===1&&q())}async function q(){if(d.value.length!=0){if(c.value.chainId!=r.chainId){Z(`请切换至${c.value.chain}, 并重试`),d.value=[];return}for(let o of d.value)if(o.hasTokenInfo==!1){let a=p.wallet.contract(o.address,se),k=await a.token0(),e=await p.wallet.contract(k,D).symbol(),w=await a.token1(),y=await p.wallet.contract(w,D).symbol();o.tokenList[0]={symbol:e.toUpperCase(),address:k.toLowerCase()},o.tokenList[1]={symbol:y.toUpperCase(),address:w.toLowerCase()},o.symbol=`${e}/${y}`}}}return Y(()=>{console.log("onMounted"),z()}),(o,a)=>{const k=L("van-search"),h=L("van-icon"),e=L("van-cell"),w=L("van-list");return i(),_("div",ne,[m(k,{modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=t=>l.value=t),shape:"round","show-action":"",placeholder:o.$t("searchTokenContractOrName"),"action-text":o.$t("cancel"),onCancel:j},null,8,["modelValue","placeholder","action-text"]),s("div",ae,[s("div",le,[s("div",{class:T({select:u.value==0}),onClick:a[1]||(a[1]=t=>F(0))},"我的代币",2),s("div",{class:T({select:u.value==1}),onClick:a[2]||(a[2]=t=>F(1))},"我的LP",2)]),s("div",ce,[s("ul",ie,[(i(!0),_(b,null,V(n(B),t=>(i(),_("li",{class:T(c.value.chain==t.chain?"network-selected":""),onClick:y=>U(t)},v(t.chain.toUpperCase()),11,re))),256))])]),s("div",null,[m(w,{"finished-text":o.$t("noMore"),class:"token-list"},{default:x(()=>[(i(!0),_(b,null,V(n(M),t=>(i(),O(e,{class:"item",key:t,onClick:y=>W(t)},{title:x(()=>[s("div",de,[u.value==0?(i(),_(b,{key:0},[m(I,{class:"token-icon-1",tokenIcon:t.icon,chainIcon:n(te)(t.chain)},null,8,["tokenIcon","chainIcon"]),s("div",ue,[s("div",ke,v(t.symbol),1),s("div",ve,v(n(R)(t.address)),1)])],64)):(i(),_(b,{key:1},[s("div",_e,[m(I,{class:"token-icon-2",tokenIcon:n(S)(t.chain,t.tokenList[0].address)},null,8,["tokenIcon"]),m(I,{class:"token-icon-2",tokenIcon:n(S)(t.chain,t.tokenList[1].address)},null,8,["tokenIcon"])]),s("div",he,[s("div",fe,v(t.symbol),1),s("div",me,v(n(R)(t.address)),1)])],64))])]),value:x(()=>[s("div",pe,[s("div",Ce,[s("div",we,v(n(g)(t.amount).toString().indexOf(".")==-1?n(g)(t.amount):n(g)(t.amount).toFixed(6)),1),s("div",ye,"$"+v(n(g)(t.amount).multipliedBy(t.price).toFixed(2)),1)]),s("div",Le,[n(r).token&&n(r).token.address==t.address?(i(),O(h,{key:0,name:"success",color:"#3F80F7"})):ee("",!0)])])]),_:2},1032,["onClick"]))),128))]),_:1},8,["finished-text"])])])])}}},$e=G(be,[["__scopeId","data-v-238a80db"]]);export{$e as default};
