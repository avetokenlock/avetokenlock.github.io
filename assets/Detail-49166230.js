import{D as oo,_ as to}from"./DelayPopup-adbd8ffa.js";import{O as so,_ as O,d as A}from"./InputQty.vuevuetypestyleindex0scopedc76ad684lang-1bc5cab1.js";import{T as $}from"./TokenIcon-70b61560.js";import{_ as K,x as Q,r as p,w as eo,l as V,d as E,o as L,f as S,c as l,g as C,h as t,v as c,j as k,t as d,F as R,k as r,J as U,I as P,L as H,M as j,N as ao,p as z,n as W,D as no,C as co,E as lo,q as io,K as ro}from"./index-16fefa86.js";import{l as X}from"./lpABI-5e9b72a1.js";import{b as B,f as D,a as Z,B as q,c as J}from"./bignumber-0890a5b7.js";import{I as uo}from"./InputQty-07f45d07.js";const mo="/assets/images/time.png",ko="/assets/images/add.png";const T=m=>(z("data-v-89be29f7"),m=m(),W(),m),_o={class:"ave-popup"},po=T(()=>t("div",{class:"title"},"追加锁定",-1)),ho={class:"body"},vo={class:"info"},yo=T(()=>t("div",{class:"key"},"追加资产",-1)),bo={class:"value"},wo={key:0,class:"token"},fo={key:1,class:"token"},go=T(()=>t("div",{class:"key"},"当前金额",-1)),Co={class:"value"},Lo=T(()=>t("div",{class:"key"},"余额",-1)),Io={class:"value"},Do=T(()=>t("div",{class:"key"},"服务费",-1)),$o={class:"value"},So={style:{}},Po={__name:"AppendLockPopup",props:{show:Boolean,lockId:Number,isLpToken:Boolean,unlockDate:Number,tokenList:Array,symbol:String,address:String,chainMainCoinSymbol:String,amount:Number,chain:String,decimals:Number},emits:["update:show"],setup(m,{emit:N}){const s=m,h=Q(),o=p(""),v=p(0),f=p(""),x=p(!1),M=p("");async function Y(){const e=r.wallet.getEthersProvider();if(s.isLpToken){const n=await r.wallet.contractByProvider(e,s.address,X).balanceOf(h.walletAddress);v.value=Number(U(n,s.decimals))}else{const n=await r.wallet.contractByProvider(e,s.address,P).balanceOf(h.walletAddress);console.log(n),v.value=Number(U(n,s.decimals))}}async function F(){const e=r.wallet.getEthersProvider(),a=r.wallet.contractByProvider(e,h.lockContractAddress,H),_=await r.wallet.contractByProvider(e,s.address,P).decimals(),u=q(s.amount).plus(1e-15).toNumber().toString(),g=j(u,_),I=await e.getGasPrice();let b=await a.estimateGas.editLock(s.lockId.toString(),g.toString(),s.unlockDate);console.dir(b),f.value=ao(b.mul(I)).toString()}async function y(){const e=V({message:"Loading...",forbidClick:!0,duration:0}),a=r.wallet.getEthersProvider(),n=r.wallet.contractByProvider(a,h.lockContractAddress,H),u=await r.wallet.contractByProvider(a,s.address,P).decimals(),g=q(s.amount).plus(Number(o.value)).toNumber().toString();console.log(g);const I=j(g,u);try{let b=await n.editLock(s.lockId.toString(),I.toString(),s.unlockDate);console.dir(b),M.value=b.hash,x.value=!0}catch(b){console.log(b)}finally{e.close()}}eo(()=>s.show,(e,a)=>{e&&i()});async function i(){const e=V({message:"Loading...",forbidClick:!0,duration:0});await Y(),await F(),e.close()}return(e,a)=>{const n=E("van-button"),_=E("van-popup");return L(),S(R,null,[l(_,{show:m.show,"onUpdate:show":a[1]||(a[1]=u=>{N("update:show",u)}),round:"",closeable:"",position:"bottom"},{default:C(()=>[t("div",_o,[po,t("div",ho,[t("ul",vo,[t("li",null,[yo,t("div",bo,[s.isLpToken?(L(),S("div",wo,[l($,{class:"token-icon",tokenIcon:c(B)(s.chain,s.tokenList[0].address)},null,8,["tokenIcon"]),l($,{class:"token-icon",tokenIcon:c(B)(s.chain,s.tokenList[1].address)},null,8,["tokenIcon"]),k(" "+d(`${s.symbol} (${c(D)(s.address)})`),1)])):(L(),S("div",fo,[l($,{class:"token-icon",tokenIcon:c(B)(s.chain,s.address),chainIcon:c(Z)(s.chain)},null,8,["tokenIcon","chainIcon"]),k(" "+d(`${s.symbol} (${c(D)(s.address)})`),1)]))])]),t("li",null,[go,t("div",Co,d(s.amount),1)]),t("li",null,[Lo,t("div",Io,d(`${v.value} ${s.symbol}`),1)]),t("li",null,[Do,t("div",$o,d(`${f.value?f.value:"--"} ${s.chainMainCoinSymbol}`),1)])]),t("div",So,[l(uo,{total:v.value,amount:o.value,"onUpdate:amount":a[0]||(a[0]=u=>o.value=u)},null,8,["total","amount"])]),l(n,{class:"btn",type:"primary",block:"",onClick:y},{default:C(()=>[k("确认并锁定")]),_:1})])])]),_:1},8,["show"]),l(so,{show:x.value,"onUpdate:show":a[2]||(a[2]=u=>x.value=u),txHash:M.value},null,8,["show","txHash"])],64)}}},Bo=K(Po,[["__scopeId","data-v-89be29f7"]]);const w=m=>(z("data-v-ad4016d4"),m=m(),W(),m),No={class:"body"},xo={key:0,class:"token"},Ao={key:1,class:"token"},To={class:"info"},Mo={class:"item"},Eo=w(()=>t("div",{class:"key"},"合约地址",-1)),Uo={class:"value"},Yo={class:"item"},Fo=w(()=>t("div",{class:"key"},"所属公链",-1)),Ho={class:"value"},Go={class:"item"},Oo={class:"key"},Vo={class:"value"},jo={class:"item"},qo=w(()=>t("div",{class:"key"},"解除锁定",-1)),Jo={class:"value"},Ko={class:"blue-font"},Qo={class:"item"},Ro=w(()=>t("div",{class:"key"},"锁定用户",-1)),zo={class:"value"},Wo={class:"item"},Xo=w(()=>t("div",{class:"key"},"锁仓时间",-1)),Zo={class:"value"},ot=w(()=>t("div",{class:"footer"},[t("span",null,"合约审计支持："),t("img",{src:to,alt:""})],-1)),tt=w(()=>t("img",{src:mo,alt:""},null,-1)),st=w(()=>t("img",{src:ko,alt:""},null,-1)),et={__name:"Detail",props:{lockId:Number},setup(m){const N=m,s=Q(),h=p(!1),o=no({id:N.lockId,address:"",amount:0,tokenList:[],lockDate:0,unlockDate:0,isLpToken:!1,symbol:"",chain:"bsc",isExpired:!1,chainMainCoinSymbol:"BNB",decimals:0}),v=p(!1),f=p(!1);async function x(){h.value=!1;const y=r.wallet.getEthersProvider(),i=r.wallet.contractByProvider(y,s.lockContractAddress,H);console.dir(i);let e=await i.getLockById(N.lockId);console.dir(e),o.lockDate=e.lockDate.toNumber(),o.unlockDate=e.tgeDate.toNumber(),o.address=e.token,o.owner=e.owner,o.isExpired=A().unix()>=o.unlockDate;try{const a=r.wallet.contractByProvider(y,o.address,X);let n=await a.decimals();o.decimals=n;let _=await a.token0(),g=await r.wallet.contract(_,P).symbol(),I=await a.token1(),G=await r.wallet.contract(I,P).symbol();o.isLpToken=!0,o.tokenList[0]={symbol:g.toUpperCase(),address:_.toLowerCase()},o.tokenList[1]={symbol:G.toUpperCase(),address:I.toLowerCase()},o.amount=Number(U(e.amount,n)),o.symbol=`${g}/${G}`}catch{const n=r.wallet.contractByProvider(y,o.address,P);let _=await n.symbol(),u=await n.decimals();o.decimals=u,o.tokenList=[],o.isLpToken=!1,o.symbol=_.toUpperCase(),o.amount=Number(U(e.amount,u))}h.value=!0,console.log("getDetailDone")}const M=co(()=>{if(o.unlockDate<=0)return 0;const y=A.unix(o.unlockDate),i=A();return y.diff(i,"day")});function Y(){v.value=!0}function F(){f.value=!0}return lo(()=>{x()}),p(!0),console.log(N.lockId),(y,i)=>{const e=E("van-button"),a=E("van-action-bar");return L(),S(R,null,[t("div",No,[o.isLpToken?(L(),S("div",xo,[l($,{class:"token-icon",tokenIcon:c(B)(o.chain,o.tokenList[0].address)},null,8,["tokenIcon"]),l($,{class:"token-icon",tokenIcon:c(B)(o.chain,o.tokenList[1].address)},null,8,["tokenIcon"]),k(" "+d(`${o.symbol} (${c(D)(o.address)})`),1)])):(L(),S("div",Ao,[l($,{class:"token-icon",tokenIcon:c(B)(o.chain,o.address),chainIcon:c(Z)(o.chain)},null,8,["tokenIcon","chainIcon"]),k(" "+d(`${o.symbol} (${c(D)(o.address)})`),1)])),t("ul",To,[t("li",Mo,[Eo,t("div",Uo,[k(d(c(D)(o.address))+" ",1),l(O,{class:"copy-icon",name:"copy",onClick:i[0]||(i[0]=n=>c(J)(o.address))})])]),t("li",Yo,[Fo,t("div",Ho,d(o.chain.toUpperCase()),1)]),t("li",Go,[t("div",Oo,d(`${o.symbol}锁定数量`),1),t("div",Vo,d(o.amount),1)]),t("li",jo,[qo,t("div",Jo,[t("span",null,d(c(A).unix(o.unlockDate).format("YYYY-MM-DD HH:mm:ss")),1),t("span",null,[k("("),t("span",Ko,d(o.isExpired?"已到期":`剩余${c(M)}天`),1),k(")")])])]),t("li",Qo,[Ro,t("div",zo,[k(d(c(D)(o.owner))+" ",1),l(O,{class:"copy-icon",name:"copy",onClick:i[1]||(i[1]=n=>c(J)(o.owner))})])]),t("li",Wo,[Xo,t("div",Zo,d(c(A).unix(o.lockDate).format("YYYY-MM-DD HH:mm:ss")),1)])])]),ot,!o.isExpired&&h.value&&c(s).walletAddress&&o.owner.toLowerCase()==c(s).walletAddress.toLowerCase()?(L(),io(a,{key:0,class:"tools"},{default:C(()=>[l(e,{class:"btn",color:"#9F3FF7",onClick:Y},{icon:C(()=>[tt]),default:C(()=>[k("延期")]),_:1}),l(e,{class:"btn",color:"#3F80F7",onClick:F},{icon:C(()=>[st]),default:C(()=>[k("追加锁定")]),_:1}),l(oo,{show:v.value,"onUpdate:show":i[2]||(i[2]=n=>v.value=n),lockId:o.id,isLpToken:o.isLpToken,chain:o.chain,unlockDate:o.unlockDate,tokenList:o.tokenList,symbol:o.symbol,address:o.address,chainMainCoinSymbol:o.chainMainCoinSymbol,amount:o.amount,decimals:o.decimals},null,8,["show","lockId","isLpToken","chain","unlockDate","tokenList","symbol","address","chainMainCoinSymbol","amount","decimals"]),l(Bo,{show:f.value,"onUpdate:show":i[3]||(i[3]=n=>f.value=n),lockId:o.id,isLpToken:o.isLpToken,chain:o.chain,unlockDate:o.unlockDate,tokenList:o.tokenList,symbol:o.symbol,address:o.address,chainMainCoinSymbol:o.chainMainCoinSymbol,amount:o.amount,decimals:o.decimals},null,8,["show","lockId","isLpToken","chain","unlockDate","tokenList","symbol","address","chainMainCoinSymbol","amount","decimals"])]),_:1})):ro("",!0)],64)}}},ut=K(et,[["__scopeId","data-v-ad4016d4"]]);export{ut as default};
