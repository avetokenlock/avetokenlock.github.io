import{D as Z,_ as oo}from"./DelayPopup-e5d03077.js";import{O as to,_ as x}from"./InputQty.vuevuetypestyleindex0scoped2fedd184lang-f35b55bb.js";import{T as S,a as P,f as D,g as Q,b as E,c as V,d as so}from"./TokenIcon-bf4f3d0c.js";import{_ as R,d as q,r as y,y as eo,g as U,o as v,h as I,c as d,w as L,j as t,t as e,k as l,l as p,F as W,z as j,x as i,N as G,L as A,O as z,M as F,P as ao,b as no,E as lo,G as co,H as io,A as J,D as M,I as ro,J as uo,K as mo}from"./index-0cba42c6.js";import{l as X}from"./lpABI-5e9b72a1.js";import{I as ko}from"./InputQty-a30e3aac.js";import{B as K}from"./bignumber-3e8dfdf6.js";const po="/assets/images/time.png",_o="/assets/images/add.png";const ho={class:"ave-popup"},vo={class:"title"},yo={class:"body"},bo={class:"info"},wo={class:"key"},fo={class:"value"},go={key:0,class:"token"},Co={key:1,class:"token"},$o={class:"key"},Lo={class:"value"},Io={class:"key"},Do={class:"value"},So={class:"key"},Po={class:"value"},Ao={style:{}},To={__name:"AppendLockPopup",props:{show:Boolean,lockId:Number,isLpToken:Boolean,unlockDate:Number,tokenList:Array,symbol:String,address:String,chainCoinSymbol:String,amount:Number,chain:String,decimals:Number},emits:["update:show"],setup(b,{emit:T}){const s=b,_=q(),w=y(""),o=y(0),g=y(""),C=y(!1),B=y("");async function H(){const a=i.wallet.getEthersProvider();if(s.isLpToken){const r=await i.wallet.contractByProvider(a,s.address,X).balanceOf(_.walletAddress);o.value=Number(F(r,s.decimals))}else{const r=await i.wallet.contractByProvider(a,s.address,A).balanceOf(_.walletAddress);console.log(r),o.value=Number(F(r,s.decimals))}}async function Y(){const a=i.wallet.getEthersProvider(),n=i.wallet.contractByProvider(a,_.lockContractAddress,G),f=await i.wallet.contractByProvider(a,s.address,A).decimals(),k=K(s.amount).plus(1e-15).toNumber().toString(),$=z(k,f),N=await a.getGasPrice();let h=await n.estimateGas.editLock(s.lockId.toString(),$.toString(),s.unlockDate);console.dir(h),g.value=ao(h.mul(N)).toString()}async function c(){const a=j({message:"Loading...",forbidClick:!0,duration:0}),n=i.wallet.getEthersProvider(),r=i.wallet.contractByProvider(n,_.lockContractAddress,G),k=await i.wallet.contractByProvider(n,s.address,A).decimals(),$=K(s.amount).plus(Number(w.value)).toNumber().toString();console.log($);const N=z($,k);try{let h=await r.editLock(s.lockId.toString(),N.toString(),s.unlockDate);console.dir(h),B.value=h.hash,C.value=!0}catch(h){console.log(h)}finally{a.close()}}eo(()=>s.show,(a,n)=>{a&&u()});async function u(){const a=j({message:"Loading...",forbidClick:!0,duration:0});await H(),await Y(),a.close()}function m(){window.location.reload()}return(a,n)=>{const r=U("van-button"),f=U("van-popup");return v(),I(W,null,[d(f,{show:b.show,"onUpdate:show":n[1]||(n[1]=k=>{T("update:show",k)}),round:"",closeable:"",position:"bottom"},{default:L(()=>[t("div",ho,[t("div",vo,e(a.$t("appendLock")),1),t("div",yo,[t("ul",bo,[t("li",null,[t("div",wo,e(a.$t("appendAssets")),1),t("div",fo,[s.isLpToken?(v(),I("div",go,[d(S,{class:"token-icon",tokenIcon:l(P)(s.chain,s.tokenList[0].address)},null,8,["tokenIcon"]),d(S,{class:"token-icon",tokenIcon:l(P)(s.chain,s.tokenList[1].address)},null,8,["tokenIcon"]),p(" "+e(`${s.symbol} (${l(D)(s.address)})`),1)])):(v(),I("div",Co,[d(S,{class:"token-icon",tokenIcon:l(P)(s.chain,s.address),chainIcon:l(Q)(s.chain)},null,8,["tokenIcon","chainIcon"]),p(" "+e(`${s.symbol} (${l(D)(s.address)})`),1)]))])]),t("li",null,[t("div",$o,e(a.$t("currentAmount")),1),t("div",Lo,e(s.amount),1)]),t("li",null,[t("div",Io,e(a.$t("balance")),1),t("div",Do,e(`${o.value} ${s.symbol}`),1)]),t("li",null,[t("div",So,e(a.$t("serviceFee")),1),t("div",Po,e(`${g.value?g.value:"--"} ${s.chainCoinSymbol}`),1)])]),t("div",Ao,[d(ko,{total:o.value,amount:w.value,"onUpdate:amount":n[0]||(n[0]=k=>w.value=k)},null,8,["total","amount"])]),d(r,{class:"btn",type:"primary",block:"",onClick:c},{default:L(()=>[p(e(a.$t("confirmAndLock")),1)]),_:1})])])]),_:1},8,["show"]),d(to,{show:C.value,"onUpdate:show":n[2]||(n[2]=k=>C.value=k),txHash:B.value,onClose:m},null,8,["show","txHash"])],64)}}},Bo=R(To,[["__scopeId","data-v-7aa52584"]]);const O=b=>(uo("data-v-534e751f"),b=b(),mo(),b),No={key:0,class:"body"},Eo={key:0,class:"token"},Uo={key:1,class:"token"},Fo={class:"info"},Ho={class:"item"},Yo={class:"key"},Mo={class:"value"},Go={class:"item"},Oo={class:"key"},xo={class:"value"},Vo={class:"item"},jo={class:"key"},zo={class:"value"},Jo={class:"item"},Ko={class:"key"},Qo={class:"value"},Ro={class:"blue-font"},qo={class:"item"},Wo={class:"key"},Xo={class:"value"},Zo={class:"item"},ot={class:"key"},tt={class:"value"},st={class:"footer"},et=O(()=>t("img",{src:oo,alt:""},null,-1)),at=O(()=>t("img",{src:po,alt:""},null,-1)),nt=O(()=>t("img",{src:_o,alt:""},null,-1)),lt={__name:"Detail",props:{lockId:Number},setup(b){const T=b;no("global");const{t:s}=lo(),_=q(),w=y(!1),o=co({id:T.lockId,address:"",amount:0,tokenList:[],lockDate:0,unlockDate:0,isLpToken:!1,symbol:"",chain:"",isExpired:!1,chainCoinSymbol:"",decimals:0}),g=y(!1),C=y(!1);async function B(){w.value=!1;const c=i.wallet.getEthersProvider(),u=i.wallet.contractByProvider(c,_.lockContractAddress,G);console.dir(u);let m;try{m=await u.getLockById(T.lockId)}catch{ro(s("failedToGetDetail"));return}o.lockDate=m.lockDate.toNumber(),o.unlockDate=m.tgeDate.toNumber(),o.address=m.token,o.owner=m.owner,o.isExpired=E().unix()>=o.unlockDate,o.chain=_.chain,o.chainCoinSymbol=_.chainCoinSymbol;try{const a=i.wallet.contractByProvider(c,o.address,X);let n=await a.decimals();o.decimals=n;let r=await a.token0(),k=await i.wallet.contract(r,A).symbol(),$=await a.token1(),h=await i.wallet.contract($,A).symbol();o.isLpToken=!0,o.tokenList[0]={symbol:k.toUpperCase(),address:r.toLowerCase()},o.tokenList[1]={symbol:h.toUpperCase(),address:$.toLowerCase()},o.amount=Number(F(m.amount,n)),o.symbol=`${k}/${h}`}catch{const n=i.wallet.contractByProvider(c,o.address,A);let r=await n.symbol(),f=await n.decimals();o.decimals=f,o.tokenList=[],o.isLpToken=!1,o.symbol=r.toUpperCase(),o.amount=Number(F(m.amount,f))}w.value=!0,console.log("getDetailDone")}function H(){console.log(o),g.value=!0}function Y(){C.value=!0}return io(()=>{B()}),y(!0),console.log(T.lockId),(c,u)=>{const m=U("van-button"),a=U("van-action-bar");return v(),I(W,null,[w.value?(v(),I("div",No,[o.isLpToken?(v(),I("div",Eo,[d(S,{class:"token-icon",tokenIcon:l(P)(o.chain,o.tokenList[0].address)},null,8,["tokenIcon"]),d(S,{class:"token-icon",tokenIcon:l(P)(o.chain,o.tokenList[1].address)},null,8,["tokenIcon"]),p(" "+e(`${o.symbol} (${l(D)(o.address)})`),1)])):(v(),I("div",Uo,[o.address?(v(),J(S,{key:0,class:"token-icon",tokenIcon:l(P)(o.chain,o.address.toLowerCase()),chainIcon:l(Q)(o.chain)},null,8,["tokenIcon","chainIcon"])):M("",!0),p(" "+e(`${o.symbol} (${l(D)(o.address)})`),1)])),t("ul",Fo,[t("li",Ho,[t("div",Yo,e(c.$t("contractAddress")),1),t("div",Mo,[p(e(l(D)(o.address))+" ",1),d(x,{class:"copy-icon",name:"copy",onClick:u[0]||(u[0]=n=>l(V)(o.address))})])]),t("li",Go,[t("div",Oo,e(c.$t("contractChian")),1),t("div",xo,e(o.chain.toUpperCase()),1)]),t("li",Vo,[t("div",jo,e(`${o.symbol} ${c.$t("lockNumber")}`),1),t("div",zo,e(o.amount),1)]),t("li",Jo,[t("div",Ko,e(c.$t("unlockTime2")),1),t("div",Qo,[t("span",null,e(l(E).unix(o.unlockDate).format("YYYY-MM-DD HH:mm:ss")),1),t("span",null,[p("("),t("span",Ro,e(o.isExpired?c.$t("expired"):c.$t("dayLeft",{day:l(so)(l(E).unix(o.unlockDate).toDate())})),1),p(")")])])]),t("li",qo,[t("div",Wo,e(c.$t("lockUser")),1),t("div",Xo,[p(e(l(D)(o.owner))+" ",1),d(x,{class:"copy-icon",name:"copy",onClick:u[1]||(u[1]=n=>l(V)(o.owner))})])]),t("li",Zo,[t("div",ot,e(c.$t("lockTime")),1),t("div",tt,e(l(E).unix(o.lockDate).format("YYYY-MM-DD HH:mm:ss")),1)])])])):M("",!0),t("div",st,[t("span",null,e(`${c.$t("technicalSupport")}:`),1),et]),!o.isExpired&&w.value&&l(_).walletAddress&&o.owner.toLowerCase()==l(_).walletAddress.toLowerCase()?(v(),J(a,{key:1,class:"tools"},{default:L(()=>[d(m,{class:"btn",color:"#9F3FF7",onClick:H},{icon:L(()=>[at]),default:L(()=>[p(e(c.$t("delay")),1)]),_:1}),d(m,{class:"btn",color:"#3F80F7",onClick:Y},{icon:L(()=>[nt]),default:L(()=>[p(e(c.$t("append")),1)]),_:1}),d(Z,{show:g.value,"onUpdate:show":u[2]||(u[2]=n=>g.value=n),lockId:o.id,isLpToken:o.isLpToken,chain:o.chain,unlockDate:o.unlockDate,tokenList:o.tokenList,symbol:o.symbol,address:o.address,chainCoinSymbol:o.chainCoinSymbol,amount:o.amount,decimals:o.decimals},null,8,["show","lockId","isLpToken","chain","unlockDate","tokenList","symbol","address","chainCoinSymbol","amount","decimals"]),d(Bo,{show:C.value,"onUpdate:show":u[3]||(u[3]=n=>C.value=n),lockId:o.id,isLpToken:o.isLpToken,chain:o.chain,unlockDate:o.unlockDate,tokenList:o.tokenList,symbol:o.symbol,address:o.address,chainCoinSymbol:o.chainCoinSymbol,amount:o.amount,decimals:o.decimals},null,8,["show","lockId","isLpToken","chain","unlockDate","tokenList","symbol","address","chainCoinSymbol","amount","decimals"])]),_:1})):M("",!0)],64)}}},pt=R(lt,[["__scopeId","data-v-534e751f"]]);export{pt as default};
