import{D as Z,_ as oo}from"./DelayPopup-ae6f4d1c.js";import{O as to,_ as x}from"./InputQty.vuevuetypestyleindex0scoped3bea6b36lang-52463f3d.js";import{T as D,b as S,f as I,g as Q,B as V,a as T,c as j}from"./TokenIcon-e3bee22d.js";import{_ as R,d as q,r as v,y as so,g as N,o as h,h as C,c as u,w as $,j as t,t as a,k as l,l as k,F as W,z,x as r,N as M,L as P,O as J,M as E,P as eo,b as ao,E as no,G as lo,f as co,H as io,A as K,D as Y,I as ro,J as uo,K as mo}from"./index-054d6b46.js";import{l as X}from"./lpABI-5e9b72a1.js";import{I as ko}from"./InputQty-b9441a17.js";const po="/assets/images/time.png",_o="/assets/images/add.png";const ho={class:"ave-popup"},vo={class:"title"},yo={class:"body"},bo={class:"info"},wo={class:"key"},fo={class:"value"},go={key:0,class:"token"},$o={key:1,class:"token"},Co={class:"key"},Lo={class:"value"},Io={class:"key"},Do={class:"value"},So={class:"key"},Po={class:"value"},Ao={style:{}},To={__name:"AppendLockPopup",props:{show:Boolean,lockId:Number,isLpToken:Boolean,unlockDate:Number,tokenList:Array,symbol:String,address:String,chainCoinSymbol:String,amount:Number,chain:String,decimals:Number},emits:["update:show"],setup(y,{emit:A}){const e=y,p=q(),b=v(""),o=v(0),f=v(""),g=v(!1),B=v("");async function U(){const s=r.wallet.getEthersProvider();if(e.isLpToken){const i=await r.wallet.contractByProvider(s,e.address,X).balanceOf(p.walletAddress);o.value=Number(E(i,e.decimals))}else{const i=await r.wallet.contractByProvider(s,e.address,P).balanceOf(p.walletAddress);console.log(i),o.value=Number(E(i,e.decimals))}}async function F(){const s=r.wallet.getEthersProvider(),n=r.wallet.contractByProvider(s,p.lockContractAddress,M),d=await r.wallet.contractByProvider(s,e.address,P).decimals(),m=V(e.amount).plus(1e-15).toNumber().toString(),w=J(m,d),L=await s.getGasPrice();let _=await n.estimateGas.editLock(e.lockId.toString(),w.toString(),e.unlockDate);console.dir(_),f.value=eo(_.mul(L)).toString()}async function H(){const s=z({message:"Loading...",forbidClick:!0,duration:0}),n=r.wallet.getEthersProvider(),i=r.wallet.contractByProvider(n,p.lockContractAddress,M),m=await r.wallet.contractByProvider(n,e.address,P).decimals(),w=V(e.amount).plus(Number(b.value)).toNumber().toString();console.log(w);const L=J(w,m);try{let _=await i.editLock(e.lockId.toString(),L.toString(),e.unlockDate);console.dir(_),B.value=_.hash,g.value=!0}catch(_){console.log(_)}finally{s.close()}}so(()=>e.show,(s,n)=>{s&&c()});async function c(){const s=z({message:"Loading...",forbidClick:!0,duration:0});await U(),await F(),s.close()}return(s,n)=>{const i=N("van-button"),d=N("van-popup");return h(),C(W,null,[u(d,{show:y.show,"onUpdate:show":n[1]||(n[1]=m=>{A("update:show",m)}),round:"",closeable:"",position:"bottom"},{default:$(()=>[t("div",ho,[t("div",vo,a(s.$t("appendLock")),1),t("div",yo,[t("ul",bo,[t("li",null,[t("div",wo,a(s.$t("appendAssets")),1),t("div",fo,[e.isLpToken?(h(),C("div",go,[u(D,{class:"token-icon",tokenIcon:l(S)(e.chain,e.tokenList[0].address)},null,8,["tokenIcon"]),u(D,{class:"token-icon",tokenIcon:l(S)(e.chain,e.tokenList[1].address)},null,8,["tokenIcon"]),k(" "+a(`${e.symbol} (${l(I)(e.address)})`),1)])):(h(),C("div",$o,[u(D,{class:"token-icon",tokenIcon:l(S)(e.chain,e.address),chainIcon:l(Q)(e.chain)},null,8,["tokenIcon","chainIcon"]),k(" "+a(`${e.symbol} (${l(I)(e.address)})`),1)]))])]),t("li",null,[t("div",Co,a(s.$t("currentAmount")),1),t("div",Lo,a(e.amount),1)]),t("li",null,[t("div",Io,a(s.$t("balance")),1),t("div",Do,a(`${o.value} ${e.symbol}`),1)]),t("li",null,[t("div",So,a(s.$t("serviceFee")),1),t("div",Po,a(`${f.value?f.value:"--"} ${e.chainCoinSymbol}`),1)])]),t("div",Ao,[u(ko,{total:o.value,amount:b.value,"onUpdate:amount":n[0]||(n[0]=m=>b.value=m)},null,8,["total","amount"])]),u(i,{class:"btn",type:"primary",block:"",onClick:H},{default:$(()=>[k(a(s.$t("confirmAndLock")),1)]),_:1})])])]),_:1},8,["show"]),u(to,{show:g.value,"onUpdate:show":n[2]||(n[2]=m=>g.value=m),txHash:B.value},null,8,["show","txHash"])],64)}}},Bo=R(To,[["__scopeId","data-v-0503c5ef"]]);const G=y=>(uo("data-v-63d75748"),y=y(),mo(),y),No={key:0,class:"body"},Eo={key:0,class:"token"},Uo={key:1,class:"token"},Fo={class:"info"},Ho={class:"item"},Yo={class:"key"},Mo={class:"value"},Go={class:"item"},Oo={class:"key"},xo={class:"value"},Vo={class:"item"},jo={class:"key"},zo={class:"value"},Jo={class:"item"},Ko={class:"key"},Qo={class:"value"},Ro={class:"blue-font"},qo={class:"item"},Wo={class:"key"},Xo={class:"value"},Zo={class:"item"},ot={class:"key"},tt={class:"value"},st={class:"footer"},et=G(()=>t("img",{src:oo,alt:""},null,-1)),at=G(()=>t("img",{src:po,alt:""},null,-1)),nt=G(()=>t("img",{src:_o,alt:""},null,-1)),lt={__name:"Detail",props:{lockId:Number},setup(y){const A=y;ao("global");const{t:e}=no(),p=q(),b=v(!1),o=lo({id:A.lockId,address:"",amount:0,tokenList:[],lockDate:0,unlockDate:0,isLpToken:!1,symbol:"",chain:"",isExpired:!1,chainCoinSymbol:"",decimals:0}),f=v(!1),g=v(!1);async function B(){b.value=!1;const c=r.wallet.getEthersProvider(),s=r.wallet.contractByProvider(c,p.lockContractAddress,M);console.dir(s);let n;try{n=await s.getLockById(A.lockId)}catch{ro(e("failedToGetDetail"));return}o.lockDate=n.lockDate.toNumber(),o.unlockDate=n.tgeDate.toNumber(),o.address=n.token,o.owner=n.owner,o.isExpired=T().unix()>=o.unlockDate,o.chain=p.chain,o.chainCoinSymbol=p.chainCoinSymbol;try{const i=r.wallet.contractByProvider(c,o.address,X);let d=await i.decimals();o.decimals=d;let m=await i.token0(),L=await r.wallet.contract(m,P).symbol(),_=await i.token1(),O=await r.wallet.contract(_,P).symbol();o.isLpToken=!0,o.tokenList[0]={symbol:L.toUpperCase(),address:m.toLowerCase()},o.tokenList[1]={symbol:O.toUpperCase(),address:_.toLowerCase()},o.amount=Number(E(n.amount,d)),o.symbol=`${L}/${O}`}catch{const d=r.wallet.contractByProvider(c,o.address,P);let m=await d.symbol(),w=await d.decimals();o.decimals=w,o.tokenList=[],o.isLpToken=!1,o.symbol=m.toUpperCase(),o.amount=Number(E(n.amount,w))}b.value=!0,console.log("getDetailDone")}const U=co(()=>{if(o.unlockDate<=0)return 0;const c=T.unix(o.unlockDate),s=T();return c.diff(s,"day")});function F(){console.log(o),f.value=!0}function H(){g.value=!0}return io(()=>{B()}),v(!0),console.log(A.lockId),(c,s)=>{const n=N("van-button"),i=N("van-action-bar");return h(),C(W,null,[b.value?(h(),C("div",No,[o.isLpToken?(h(),C("div",Eo,[u(D,{class:"token-icon",tokenIcon:l(S)(o.chain,o.tokenList[0].address)},null,8,["tokenIcon"]),u(D,{class:"token-icon",tokenIcon:l(S)(o.chain,o.tokenList[1].address)},null,8,["tokenIcon"]),k(" "+a(`${o.symbol} (${l(I)(o.address)})`),1)])):(h(),C("div",Uo,[o.address?(h(),K(D,{key:0,class:"token-icon",tokenIcon:l(S)(o.chain,o.address.toLowerCase()),chainIcon:l(Q)(o.chain)},null,8,["tokenIcon","chainIcon"])):Y("",!0),k(" "+a(`${o.symbol} (${l(I)(o.address)})`),1)])),t("ul",Fo,[t("li",Ho,[t("div",Yo,a(c.$t("contractAddress")),1),t("div",Mo,[k(a(l(I)(o.address))+" ",1),u(x,{class:"copy-icon",name:"copy",onClick:s[0]||(s[0]=d=>l(j)(o.address))})])]),t("li",Go,[t("div",Oo,a(c.$t("contractChian")),1),t("div",xo,a(o.chain.toUpperCase()),1)]),t("li",Vo,[t("div",jo,a(`${o.symbol} ${c.$t("lockNumber")}`),1),t("div",zo,a(o.amount),1)]),t("li",Jo,[t("div",Ko,a(c.$t("unlockTime2")),1),t("div",Qo,[t("span",null,a(l(T).unix(o.unlockDate).format("YYYY-MM-DD HH:mm:ss")),1),t("span",null,[k("("),t("span",Ro,a(o.isExpired?c.$t("expired"):c.$t("dayLeft",{day:l(U)})),1),k(")")])])]),t("li",qo,[t("div",Wo,a(c.$t("lockUser")),1),t("div",Xo,[k(a(l(I)(o.owner))+" ",1),u(x,{class:"copy-icon",name:"copy",onClick:s[1]||(s[1]=d=>l(j)(o.owner))})])]),t("li",Zo,[t("div",ot,a(c.$t("lockTime")),1),t("div",tt,a(l(T).unix(o.lockDate).format("YYYY-MM-DD HH:mm:ss")),1)])])])):Y("",!0),t("div",st,[t("span",null,a(`${c.$t("technicalSupport")}:`),1),et]),!o.isExpired&&b.value&&l(p).walletAddress&&o.owner.toLowerCase()==l(p).walletAddress.toLowerCase()?(h(),K(i,{key:1,class:"tools"},{default:$(()=>[u(n,{class:"btn",color:"#9F3FF7",onClick:F},{icon:$(()=>[at]),default:$(()=>[k(a(c.$t("delay")),1)]),_:1}),u(n,{class:"btn",color:"#3F80F7",onClick:H},{icon:$(()=>[nt]),default:$(()=>[k(a(c.$t("append")),1)]),_:1}),u(Z,{show:f.value,"onUpdate:show":s[2]||(s[2]=d=>f.value=d),lockId:o.id,isLpToken:o.isLpToken,chain:o.chain,unlockDate:o.unlockDate,tokenList:o.tokenList,symbol:o.symbol,address:o.address,chainCoinSymbol:o.chainCoinSymbol,amount:o.amount,decimals:o.decimals},null,8,["show","lockId","isLpToken","chain","unlockDate","tokenList","symbol","address","chainCoinSymbol","amount","decimals"]),u(Bo,{show:g.value,"onUpdate:show":s[3]||(s[3]=d=>g.value=d),lockId:o.id,isLpToken:o.isLpToken,chain:o.chain,unlockDate:o.unlockDate,tokenList:o.tokenList,symbol:o.symbol,address:o.address,chainCoinSymbol:o.chainCoinSymbol,amount:o.amount,decimals:o.decimals},null,8,["show","lockId","isLpToken","chain","unlockDate","tokenList","symbol","address","chainCoinSymbol","amount","decimals"])]),_:1})):Y("",!0)],64)}}},pt=R(lt,[["__scopeId","data-v-63d75748"]]);export{pt as default};
