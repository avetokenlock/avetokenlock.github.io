import{D as so,_ as eo}from"./DelayPopup-f993e897.js";import{O as ao,_ as V,d as N}from"./InputQty.vuevuetypestyleindex0scopedc76ad684lang-ebd520a2.js";import{T as S}from"./TokenIcon-11e8e5f5.js";import{_ as R,d as z,r as v,w as no,f as U,o as h,g as I,c as r,h as L,j as t,x as c,k,t as i,F as W,l as j,n as d,L as G,J as P,M as q,p as X,q as Z,K as F,N as co,E as lo,D as io,G as ro,v as J,B as M,H as uo}from"./index-5a0fd75d.js";import{l as oo}from"./lpABI-5e9b72a1.js";import{b as B,f as $,a as to,B as K,c as Q}from"./bignumber-ea2dde45.js";import{I as mo}from"./InputQty-9edd7de0.js";const ko="/assets/images/time.png",_o="/assets/images/add.png";const T=m=>(X("data-v-d2553048"),m=m(),Z(),m),po={class:"ave-popup"},ho=T(()=>t("div",{class:"title"},"追加锁定",-1)),vo={class:"body"},yo={class:"info"},wo=T(()=>t("div",{class:"key"},"追加资产",-1)),bo={class:"value"},fo={key:0,class:"token"},go={key:1,class:"token"},Co=T(()=>t("div",{class:"key"},"当前金额",-1)),Lo={class:"value"},Io=T(()=>t("div",{class:"key"},"余额",-1)),Do={class:"value"},$o=T(()=>t("div",{class:"key"},"服务费",-1)),So={class:"value"},Po={style:{}},Bo={__name:"AppendLockPopup",props:{show:Boolean,lockId:Number,isLpToken:Boolean,unlockDate:Number,tokenList:Array,symbol:String,address:String,chainCoinSymbol:String,amount:Number,chain:String,decimals:Number},emits:["update:show"],setup(m,{emit:x}){const s=m,_=z(),o=v(""),y=v(0),g=v(""),A=v(!1),E=v("");async function H(){const e=d.wallet.getEthersProvider();if(s.isLpToken){const n=await d.wallet.contractByProvider(e,s.address,oo).balanceOf(_.walletAddress);y.value=Number(F(n,s.decimals))}else{const n=await d.wallet.contractByProvider(e,s.address,P).balanceOf(_.walletAddress);console.log(n),y.value=Number(F(n,s.decimals))}}async function Y(){const e=d.wallet.getEthersProvider(),a=d.wallet.contractByProvider(e,_.lockContractAddress,G),p=await d.wallet.contractByProvider(e,s.address,P).decimals(),u=K(s.amount).plus(1e-15).toNumber().toString(),C=q(u,p),D=await e.getGasPrice();let b=await a.estimateGas.editLock(s.lockId.toString(),C.toString(),s.unlockDate);console.dir(b),g.value=co(b.mul(D)).toString()}async function w(){const e=j({message:"Loading...",forbidClick:!0,duration:0}),a=d.wallet.getEthersProvider(),n=d.wallet.contractByProvider(a,_.lockContractAddress,G),u=await d.wallet.contractByProvider(a,s.address,P).decimals(),C=K(s.amount).plus(Number(o.value)).toNumber().toString();console.log(C);const D=q(C,u);try{let b=await n.editLock(s.lockId.toString(),D.toString(),s.unlockDate);console.dir(b),E.value=b.hash,A.value=!0}catch(b){console.log(b)}finally{e.close()}}no(()=>s.show,(e,a)=>{e&&l()});async function l(){const e=j({message:"Loading...",forbidClick:!0,duration:0});await H(),await Y(),e.close()}return(e,a)=>{const n=U("van-button"),p=U("van-popup");return h(),I(W,null,[r(p,{show:m.show,"onUpdate:show":a[1]||(a[1]=u=>{x("update:show",u)}),round:"",closeable:"",position:"bottom"},{default:L(()=>[t("div",po,[ho,t("div",vo,[t("ul",yo,[t("li",null,[wo,t("div",bo,[s.isLpToken?(h(),I("div",fo,[r(S,{class:"token-icon",tokenIcon:c(B)(s.chain,s.tokenList[0].address)},null,8,["tokenIcon"]),r(S,{class:"token-icon",tokenIcon:c(B)(s.chain,s.tokenList[1].address)},null,8,["tokenIcon"]),k(" "+i(`${s.symbol} (${c($)(s.address)})`),1)])):(h(),I("div",go,[r(S,{class:"token-icon",tokenIcon:c(B)(s.chain,s.address),chainIcon:c(to)(s.chain)},null,8,["tokenIcon","chainIcon"]),k(" "+i(`${s.symbol} (${c($)(s.address)})`),1)]))])]),t("li",null,[Co,t("div",Lo,i(s.amount),1)]),t("li",null,[Io,t("div",Do,i(`${y.value} ${s.symbol}`),1)]),t("li",null,[$o,t("div",So,i(`${g.value?g.value:"--"} ${s.chainCoinSymbol}`),1)])]),t("div",Po,[r(mo,{total:y.value,amount:o.value,"onUpdate:amount":a[0]||(a[0]=u=>o.value=u)},null,8,["total","amount"])]),r(n,{class:"btn",type:"primary",block:"",onClick:w},{default:L(()=>[k("确认并锁定")]),_:1})])])]),_:1},8,["show"]),r(ao,{show:A.value,"onUpdate:show":a[2]||(a[2]=u=>A.value=u),txHash:E.value},null,8,["show","txHash"])],64)}}},xo=R(Bo,[["__scopeId","data-v-d2553048"]]);const f=m=>(X("data-v-f273c805"),m=m(),Z(),m),Ao={key:0,class:"body"},No={key:0,class:"token"},To={key:1,class:"token"},Eo={class:"info"},Uo={class:"item"},Fo=f(()=>t("div",{class:"key"},"合约地址",-1)),Ho={class:"value"},Yo={class:"item"},Mo=f(()=>t("div",{class:"key"},"所属公链",-1)),Go={class:"value"},Oo={class:"item"},Vo={class:"key"},jo={class:"value"},qo={class:"item"},Jo=f(()=>t("div",{class:"key"},"解除锁定",-1)),Ko={class:"value"},Qo={class:"blue-font"},Ro={class:"item"},zo=f(()=>t("div",{class:"key"},"锁定用户",-1)),Wo={class:"value"},Xo={class:"item"},Zo=f(()=>t("div",{class:"key"},"锁仓时间",-1)),ot={class:"value"},tt=f(()=>t("div",{class:"footer"},[t("span",null,"合约审计支持："),t("img",{src:eo,alt:""})],-1)),st=f(()=>t("img",{src:ko,alt:""},null,-1)),et=f(()=>t("img",{src:_o,alt:""},null,-1)),at={__name:"Detail",props:{lockId:Number},setup(m){const x=m,s=z(),_=v(!1),o=lo({id:x.lockId,address:"",amount:0,tokenList:[],lockDate:0,unlockDate:0,isLpToken:!1,symbol:"",chain:"",isExpired:!1,chainCoinSymbol:"",decimals:0}),y=v(!1),g=v(!1);async function A(){_.value=!1;const w=d.wallet.getEthersProvider(),l=d.wallet.contractByProvider(w,s.lockContractAddress,G);console.dir(l);let e;try{e=await l.getLockById(x.lockId)}catch{uo("获取详情失败,请确认网络或者id");return}o.lockDate=e.lockDate.toNumber(),o.unlockDate=e.tgeDate.toNumber(),o.address=e.token,o.owner=e.owner,o.isExpired=N().unix()>=o.unlockDate,o.chain=s.chain;try{const a=d.wallet.contractByProvider(w,o.address,oo);let n=await a.decimals();o.decimals=n;let p=await a.token0(),C=await d.wallet.contract(p,P).symbol(),D=await a.token1(),O=await d.wallet.contract(D,P).symbol();o.isLpToken=!0,o.tokenList[0]={symbol:C.toUpperCase(),address:p.toLowerCase()},o.tokenList[1]={symbol:O.toUpperCase(),address:D.toLowerCase()},o.amount=Number(F(e.amount,n)),o.symbol=`${C}/${O}`}catch{const n=d.wallet.contractByProvider(w,o.address,P);let p=await n.symbol(),u=await n.decimals();o.decimals=u,o.tokenList=[],o.isLpToken=!1,o.symbol=p.toUpperCase(),o.amount=Number(F(e.amount,u))}_.value=!0,console.log("getDetailDone")}const E=io(()=>{if(o.unlockDate<=0)return 0;const w=N.unix(o.unlockDate),l=N();return w.diff(l,"day")});function H(){console.log(o),y.value=!0}function Y(){g.value=!0}return ro(()=>{A()}),v(!0),console.log(x.lockId),(w,l)=>{const e=U("van-button"),a=U("van-action-bar");return h(),I(W,null,[_.value?(h(),I("div",Ao,[o.isLpToken?(h(),I("div",No,[r(S,{class:"token-icon",tokenIcon:c(B)(o.chain,o.tokenList[0].address)},null,8,["tokenIcon"]),r(S,{class:"token-icon",tokenIcon:c(B)(o.chain,o.tokenList[1].address)},null,8,["tokenIcon"]),k(" "+i(`${o.symbol} (${c($)(o.address)})`),1)])):(h(),I("div",To,[o.address?(h(),J(S,{key:0,class:"token-icon",tokenIcon:c(B)(o.chain,o.address.toLowerCase()),chainIcon:c(to)(o.chain)},null,8,["tokenIcon","chainIcon"])):M("",!0),k(" "+i(`${o.symbol} (${c($)(o.address)})`),1)])),t("ul",Eo,[t("li",Uo,[Fo,t("div",Ho,[k(i(c($)(o.address))+" ",1),r(V,{class:"copy-icon",name:"copy",onClick:l[0]||(l[0]=n=>c(Q)(o.address))})])]),t("li",Yo,[Mo,t("div",Go,i(o.chain.toUpperCase()),1)]),t("li",Oo,[t("div",Vo,i(`${o.symbol}锁定数量`),1),t("div",jo,i(o.amount),1)]),t("li",qo,[Jo,t("div",Ko,[t("span",null,i(c(N).unix(o.unlockDate).format("YYYY-MM-DD HH:mm:ss")),1),t("span",null,[k("("),t("span",Qo,i(o.isExpired?"已到期":`剩余${c(E)}天`),1),k(")")])])]),t("li",Ro,[zo,t("div",Wo,[k(i(c($)(o.owner))+" ",1),r(V,{class:"copy-icon",name:"copy",onClick:l[1]||(l[1]=n=>c(Q)(o.owner))})])]),t("li",Xo,[Zo,t("div",ot,i(c(N).unix(o.lockDate).format("YYYY-MM-DD HH:mm:ss")),1)])])])):M("",!0),tt,!o.isExpired&&_.value&&c(s).walletAddress&&o.owner.toLowerCase()==c(s).walletAddress.toLowerCase()?(h(),J(a,{key:1,class:"tools"},{default:L(()=>[r(e,{class:"btn",color:"#9F3FF7",onClick:H},{icon:L(()=>[st]),default:L(()=>[k("延期")]),_:1}),r(e,{class:"btn",color:"#3F80F7",onClick:Y},{icon:L(()=>[et]),default:L(()=>[k("追加锁定")]),_:1}),r(so,{show:y.value,"onUpdate:show":l[2]||(l[2]=n=>y.value=n),lockId:o.id,isLpToken:o.isLpToken,chain:o.chain,unlockDate:o.unlockDate,tokenList:o.tokenList,symbol:o.symbol,address:o.address,chainCoinSymbol:o.chainCoinSymbol,amount:o.amount,decimals:o.decimals},null,8,["show","lockId","isLpToken","chain","unlockDate","tokenList","symbol","address","chainCoinSymbol","amount","decimals"]),r(xo,{show:g.value,"onUpdate:show":l[3]||(l[3]=n=>g.value=n),lockId:o.id,isLpToken:o.isLpToken,chain:o.chain,unlockDate:o.unlockDate,tokenList:o.tokenList,symbol:o.symbol,address:o.address,chainCoinSymbol:o.chainCoinSymbol,amount:o.amount,decimals:o.decimals},null,8,["show","lockId","isLpToken","chain","unlockDate","tokenList","symbol","address","chainCoinSymbol","amount","decimals"])]),_:1})):M("",!0)],64)}}},mt=R(at,[["__scopeId","data-v-f273c805"]]);export{mt as default};
