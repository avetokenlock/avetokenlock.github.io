import{g as K,T,f as E,b as F,B as W}from"./TokenIcon-78ed9b26.js";/* empty css                                                              */import{_ as Q,q as X,d as lo,f as $,o as v,C as G,w as k,h as e,t as n,j as o,g as C,c,k as p,G as Z,A as co,B as io,H as ro,b as uo,r as f,D as ko,J as vo,F as R,z as m,y as po,L as q,O as z,N as J,V as ho,K as b,P as fo}from"./index-1e0725da.js";import{I as mo}from"./InputQty-60b7c58a.js";import{d as A,O as _o,S as wo}from"./InputQty.vuevuetypestyleindex0scoped3bea6b36lang-0f48e35d.js";const yo=i=>(co("data-v-1b42ba62"),i=i(),io(),i),go={class:"ave-popup"},bo={class:"title"},Co={class:"body"},Io={class:"info"},$o={class:"key"},To={class:"value"},Ao={key:0,class:"token"},So={key:1,class:"token"},Do={key:2,class:"token"},Lo={class:"key"},Bo={class:"value"},Po={class:"key"},No={class:"value"},Go={class:"key"},Eo={class:"value"},Fo={class:"blue-font"},Uo={class:"key"},Oo={class:"value"},xo=yo(()=>e("div",{class:"tips"},[e("div",null,"*1, 如代币存在交易限额可能会造成锁定失败;"),e("div",null," 2, 如代币存在交易或转账燃烧, 可能会造成实际锁定数量小于页面显示数量;"),e("div",null," 3, 锁定完成后, 将无法撤回或提前终止锁定。")],-1)),Mo={__name:"LockConfirmPopup",props:{show:Boolean,showGas:String,amount:String,unlockDate:Date},emits:["update:show","confirm"],setup(i,{emit:r}){const L=i,s=X(),S=lo(()=>{if(!L.unlockDate)return 0;const d=A(L.unlockDate),t=A().startOf("day");return d.diff(t,"day")});function D(){r("confirm")}return(d,t)=>{const U=$("van-button"),w=$("van-popup");return v(),G(w,{show:i.show,"onUpdate:show":t[0]||(t[0]=h=>{r("update:show",h)}),round:"",closeable:"",position:"bottom"},{default:k(()=>[e("div",go,[e("div",bo,n(d.$t("lockConfirm")),1),e("div",Co,[e("ul",Io,[e("li",null,[e("div",$o,n(d.$t("lockAssets")),1),e("div",To,[o(s).token?o(s).token.tokenType==0?(v(),C("div",So,[c(T,{class:"token-icon",tokenIcon:o(s).token.icon,chainIcon:o(K)(o(s).token.chain)},null,8,["tokenIcon","chainIcon"]),p(" "+n(`${o(s).token.symbol} (${o(E)(o(s).token.address)})`),1)])):o(s).token.tokenType==1?(v(),C("div",Do,[c(T,{class:"token-icon",tokenIcon:o(F)(o(s).token.chain,o(s).token.tokenList[0].address)},null,8,["tokenIcon"]),c(T,{class:"token-icon",tokenIcon:o(F)(o(s).token.chain,o(s).token.tokenList[1].address)},null,8,["tokenIcon"]),p(" "+n(`${o(s).token.symbol} (${o(E)(o(s).token.address)})`),1)])):Z("",!0):(v(),C("div",Ao," -- "))])]),e("li",null,[e("div",Lo,n(d.$t("lockNumber")),1),e("div",Bo,n(i.amount),1)]),e("li",null,[e("div",Po,n(d.$t("contractChian")),1),e("div",No,n(o(s).token?o(s).token.chain.toUpperCase():"--"),1)]),e("li",null,[e("div",Go,n(d.$t("unlockTime2")),1),e("div",Eo,[e("span",null,n(o(A)(i.unlockDate).format("YYYY-MM-DD")),1),e("span",null,[p("("),e("span",Fo,"剩余"+n(o(S))+"天",1),p(")")])])]),e("li",null,[e("div",Uo,n(d.$t("serviceFee")),1),e("div",Oo,n(o(s).token&&i.showGas?`${i.showGas} ${o(s).token.chainCoinSymbol.toUpperCase()}`:"--"),1)])]),xo,c(U,{class:"btn",type:"primary",block:"",onClick:D},{default:k(()=>[p(n(d.$t("confirmAndLock")),1)]),_:1})])])]),_:1},8,["show"])}}},Vo=Q(Mo,[["__scopeId","data-v-1b42ba62"]]);const Wo={class:"body"},Ho={class:"title token-title"},Yo={key:0,class:"token-box"},jo={key:1,class:"token"},Ro={class:"title"},qo={class:"title"},zo={__name:"Create",setup(i){const{t:r}=ro(),L=uo("global"),s=f(!1),S=f(!1),D=f(!1),d=ko(),t=X(),U=A().startOf("day").add(1,"day").toDate(),w=f(U),h=f(""),B=f(!1),H=f(""),O=f(!1),x=f("");async function oo(){await t.connectWallet()}async function Y(){console.log("checkAllowance"),await m.wallet.isAllowanceEnough(t.lockContractAddress,t.token.address,t.walletAddress)?s.value=!1:s.value=!0}async function to(){S.value=!0;try{let a=await m.wallet.approveMaxAmount(t.token.address,t.lockContractAddress);console.log(a),await a.wait(),s.value=!1}catch(a){console.log(a)}finally{S.value=!1}}async function eo(){D.value=!0,x.value="";try{if(!t.token){b(r("pleaseSelectToken"));return}if(!h.value){b("请输入金额");return}let a=L.cfg.allowChainList.find(y=>y.chain==t.token.chain);if(!a){b(r("tokenChainNotSupport"));return}if(t.chainId!=a.chainId){b(r("switchTokenChain"));try{await m.wallet.switchNetwork(a.chainId)}catch{b(r("switchTokenChain"));return}return}if(Number(h)>t.token.amount){b(r("blanceSlow"));return}if(await Y(),s.value){b(r("approveFirst"));return}await no()}catch(a){console.log(a)}finally{D.value=!1}}async function no(){const a=t.token.address,l=m.wallet.getEthersProvider(),_=await m.wallet.contractByProvider(l,a,q).decimals(),g=t.walletAddress,P=t.token.tokenType==1,u=z(h.value,_),M=A(w.value).unix(),V="",N=m.wallet.contractByProvider(l,t.lockContractAddress,J);console.dir(N);const I=await l.getGasPrice();let j=await N.estimateGas.lock(g,a,P,u.toString(),M,V);console.dir(j),H.value=fo(j.mul(I)).toString(),B.value=!0}async function so(){const a=po({message:"Loading...",forbidClick:!0,duration:0}),l=t.token.address,y=t.walletAddress,_=m.wallet.getEthersProvider(),g=t.token.tokenType==1,u=await m.wallet.contractByProvider(_,l,q).decimals(),M=z(h.value,u),V=A(w.value).unix(),N=m.wallet.contractByProvider(_,t.lockContractAddress,J);try{let I=await N.lock(y,l,g,M.toString(),V,"");console.dir(I),x.value=I.hash,O.value=!0,B.value=!1}catch(I){console.log(I)}finally{a.close()}}function ao(){d.push("/selectToken")}return vo(()=>{console.log("onMounted"),t.chainId>0&&t.isConnectWallet&&t.token&&Y()}),(a,l)=>{const y=$("van-cell"),_=$("van-cell-group"),g=$("van-button"),P=$("van-action-bar");return v(),C(R,null,[e("div",Wo,[c(_,{inset:"",class:"form-item"},{default:k(()=>[e("div",Ho,n(a.$t("selectToken2")),1),c(y,{"is-link":"",class:"token-cell",onClick:ao},ho({_:2},[o(t).token?{name:"title",fn:k(()=>[o(t).token.tokenType==0?(v(),C("div",Yo,[c(T,{class:"token-icon",tokenIcon:o(t).token.icon,chainIcon:o(K)(o(t).token.chain)},null,8,["tokenIcon","chainIcon"]),p(" "+n(`${o(t).token.symbol} (${o(E)(o(t).token.address)})`),1)])):o(t).token.tokenType==1?(v(),C("div",jo,[c(T,{class:"token-icon",tokenIcon:o(F)(o(t).token.chain,o(t).token.tokenList[0].address)},null,8,["tokenIcon"]),c(T,{class:"token-icon",tokenIcon:o(F)(o(t).token.chain,o(t).token.tokenList[1].address)},null,8,["tokenIcon"]),p(" "+n(`${o(t).token.symbol} (${o(E)(o(t).token.address)})`),1)])):Z("",!0)]),key:"0"}:{name:"title",fn:k(()=>[e("div",{class:"token-box",style:{color:"#999999"}},n(a.$t("pleaseSelectToken")),1)]),key:"1"}]),1024)]),_:1}),c(_,{inset:"",class:"form-item"},{default:k(()=>[e("div",Ro,[e("div",null,n(o(r)("setNumberOfLock")),1),e("div",null,[p(n(`${o(r)("balance")}: `),1),e("span",null,n(o(t).token?o(W)(o(t).token.amount).toString().indexOf(".")==-1?o(W)(o(t).token.amount):o(W)(o(t).token.amount).toFixed(6):"--"),1)])]),e("div",null,[c(mo,{amount:h.value,"onUpdate:amount":l[0]||(l[0]=u=>h.value=u),total:o(t).token?o(t).token.amount:0},null,8,["amount","total"])])]),_:1}),c(_,{inset:"",class:"form-item"},{default:k(()=>[e("div",qo,[e("div",null,n(a.$t("setDate")),1)]),e("div",null,[c(wo,{date:w.value,"onUpdate:date":l[1]||(l[1]=u=>w.value=u),showTools:""},null,8,["date"])])]),_:1})]),c(P,{class:"tools"},{default:k(()=>[o(t).isConnectWallet?(v(),C(R,{key:0},[s.value?(v(),G(g,{key:0,class:"btn",type:"danger",onClick:to,block:"",loading:S.value},{default:k(()=>[p(n(a.$t("approve")),1)]),_:1},8,["loading"])):(v(),G(g,{key:1,class:"btn",color:"#3F80F7",onClick:eo,block:"",loading:D.value},{default:k(()=>[p("一键锁定")]),_:1},8,["loading"]))],64)):(v(),G(g,{key:1,class:"btn",type:"primary",onClick:oo,block:""},{default:k(()=>[p(n(a.$t("connectWallet")),1)]),_:1}))]),_:1}),c(Vo,{show:B.value,"onUpdate:show":l[2]||(l[2]=u=>B.value=u),unlockDate:w.value,amount:h.value,showGas:H.value,onConfirm:so},null,8,["show","unlockDate","amount","showGas"]),c(_o,{show:O.value,"onUpdate:show":l[3]||(l[3]=u=>O.value=u),txHash:x.value},null,8,["show","txHash"])],64)}}},ot=Q(zo,[["__scopeId","data-v-478df1bf"]]);export{ot as default};
